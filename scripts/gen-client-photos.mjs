#!/usr/bin/env node
import { promises as fs } from 'node:fs';
import path from 'node:path';

async function main() {
  const publicDir = path.resolve('public', 'clientes');
  try {
    const entries = await fs.readdir(publicDir, { withFileTypes: true });
    const files = entries
      .filter((e) => e.isFile())
      .map((e) => e.name)
      .filter((n) => /\.(jpe?g|png|webp|avif)$/i.test(n))
      .sort((a, b) => a.localeCompare(b, 'pt-BR'));

    const list = files.map((n) => `/clientes/${n}`);
    const outPath = path.resolve('src', 'components', 'clientPhotos.ts');
    const header = `// AUTO-GENERATED by scripts/gen-client-photos.mjs\n`;
    const body = `const CLIENT_PHOTOS = ${JSON.stringify(list, null, 2)} as const;\nexport default CLIENT_PHOTOS;\n`;
    await fs.writeFile(outPath, header + body, 'utf8');
    console.log(`Generated ${outPath} with ${list.length} items.`);
  } catch (err) {
    console.error('Failed to generate client photos:', err.message || err);
    process.exit(0); // do not fail build if folder missing
  }
}

main();

